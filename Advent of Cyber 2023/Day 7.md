# Log Anlysis

So we'll be analysing the log file **access.log** to answer the question below.

## How many unique IP addresses are connected to the proxy server?

This can be answered by piping down the following commands

- **`cut -d ' ' -f2 access.log | sort | uniq -c | sort -n`**
  -  **cut** allows us to extract specific section (columns) and **-d ' '** means that space is being used as a delimeter
  -  **`-f2 access.log`** means to cut from column 2 of the **access.log** file since SOURCE IP is stored in that column
  - **`sort`** arranges the list in a alphabetical order
  - **`uniq -c`** removes all duplicate domains and gives us the list of unique domains and **-c** means that it also gives the number of times the domain has been accessed
  - **`sort -n`** sorts the data in ascending order

![image](https://github.com/Wixter07/HARSHITH-JTP-2/assets/150792650/f8a059f4-d95d-444e-988c-8b8585f5dfbe)

I counted the IP addresses manually

**`Ans-  9`**

## How many unique domains were accessed by all workstations?

This can be answered by piping down the following commands
- **`cut -d ' ' -f3 access.log | cut -d ':' -f1 | sort | uniq -c | sort -n | wc -l`**
  - **`-f3 access.log`** means to cut from column 3 of the **access.log** file sice that's the column where domain and port number is stored
  - **` cut -d ':' -f1`** removes the port by splitting it with a colon.
  - **`wc -l`** gives the the total number of domains given as the output

![image](https://github.com/Wixter07/HARSHITH-JTP-2/assets/150792650/5383110f-c28b-4b93-9ebc-f451ca15a568)

**`Ans- 111`**


## What status code is generated by the HTTP requests to the least accessed domain?

This can be answered by piping down the following commands
- First we find the least accessed domain as 
  - **`cut -d ' ' -f3 access.log | cut -d ':' -f1 | sort | uniq -c`**

Here we find that **partnerservices** is the least accessed domain with 78 users accessing it.

- Then we find the status code of this domain as
  - **`cut -d ' ' -f3,6 access.log | grep partnerservices`**
    - **-f3,6** cuts from the columns 3 and 6 which has the domain name and the status code
    - **grep** is used to search for the partnerservies domain

![Screenshot (99)](https://github.com/Wixter07/HARSHITH-JTP-2/assets/150792650/ebe9e8ba-482c-452d-82eb-c2d94b72f800)

From this we get the answers as
**`Ans- 503`**

## Based on the high count of connection attempts, what is the name of the suspicious domain?

The suspicious domain can be found piping the following command wherein we use tail command to list out the top 10 domains accessed by the users
- **`cut -d ' ' -f3 access.log | cut -d ':' -f1 | sort | uniq -c | sort -n | tail -n 10`**
  - **`tail -n 10`** lists the top domains accessed by the users

 ![Screenshot (94)](https://github.com/Wixter07/HARSHITH-JTP-2/assets/150792650/84f4b1f2-296b-4629-9358-85fdb4369579)
    
Out of all , **frostlings.bigbadstash.thm** looks the most suspicious and the intuition turns out to be correct.

 **`Ans- frostlings.bigbadstash.thm`**

 ## What is the source IP of the workstation that accessed the malicious domain?
 This can be done by piping down the following commmands
 - **`cut -d ' ' -f2,3 access.log | grep frostlings.bigbadstash.thm`**

![image](https://github.com/Wixter07/HARSHITH-JTP-2/assets/150792650/de7ffc4d-f969-469a-861e-be1408d3ad9d)

**`Ans- 10.10.185.225`**

## How many requests were made on the malicious domain in total? 

This can be done by piping down the following commands
 - **`cut -d ' ' -f2,3 access.log | grep frostlings.bigbadstash.thm | wc -l`**

![image](https://github.com/Wixter07/HARSHITH-JTP-2/assets/150792650/19bb1fe7-8b69-4e20-9f86-9c47c6099729)

**`Ans- 1581`**


## Having retrieved the exfiltrated data, what is the hidden flag?

This can be done by piping down the following commands
- **`grep frostlings.bigbadstash.thm access.log | cut -d ' ' -f5 | cut -d '=' -f2`**

This gives ton of strings which seems to be Base64 encoded. So we can decrypt it by the following command
- **`grep frostlings.bigbadstash.thm access.log | cut -d ' ' -f5 | cut -d '=' -f2 |base64 -d`**

Here, we can look through the decrypted text to get the flag.

![Screenshot (102)](https://github.com/Wixter07/HARSHITH-JTP-2/assets/150792650/ea1f92df-a106-4686-8302-a8409959bcd0)

**`Ans- THM{a_gift_for_you_awesome_analyst!}`**
